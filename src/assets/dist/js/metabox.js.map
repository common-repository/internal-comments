{"version":3,"file":"metabox.js","mappings":";;;;;;;;;;;AAQQ,IAAMA,UAAb;EA2CG,sBAAsB;IAAA;;IAClB,KAAKC,QAAL,GAAyBC,MAAM,CAAE,wBAAF,CAA/B;IACA,KAAKC,iBAAL,GAAyB,KAAKF,QAAL,CAAcG,IAAd,CAAoB,wBAApB,CAAzB;IACA,KAAKC,SAAL,GAAyB,KAAKJ,QAAL,CAAcG,IAAd,CAAoB,uBAApB,CAAzB;IACA,KAAKE,QAAL,GAAyB,KAAKL,QAAL,CAAcG,IAAd,CAAoB,gCAApB,CAAzB;IAEA,KAAKG,IAAL;EACH;;EAlDJ;IAAA;IAAA,OA0EG,gBAAuB;MACnB,IAAMC,QAAQ,GAAG,IAAjB;MAEA,KAAKP,QAAL,CAAcQ,EAAd,CAAkB,OAAlB,EAA2B,qCAA3B,EAAkE,UAAUC,CAAV,EAAc;QAC5E,IAAMC,OAAO,GAAGH,QAAQ,CAACH,SAAT,CAAmBO,GAAnB,EAAhB;;QAEA,IAAK,aAAa,OAAOD,OAApB,IAA+BA,OAAO,CAACE,IAAR,GAAeC,MAAf,KAA0B,CAA9D,EAAkE;UAC9DC,KAAK,CAAEC,MAAM,CAACC,mBAAP,CAA2BC,iBAA7B,CAAL;UACA;QACH;;QAEDR,CAAC,CAACS,cAAF;QACAX,QAAQ,CAACY,cAAT,CAAyBT,OAAzB;MACH,CAVD;MAWA,KAAKV,QAAL,CAAcQ,EAAd,CAAkB,OAAlB,EAA2B,0DAA3B,EAAuF,UAAUC,CAAV,EAAc;QACjG,IAAMW,OAAO,GAAYnB,MAAM,CAAEQ,CAAC,CAACY,MAAJ,CAA/B;QAAA,IACIC,MAAM,GAAaF,OAAO,CAACG,IAAR,CAAc,QAAd,CADvB;QAAA,IAEIC,KAAK,GAAcJ,OAAO,CAACG,IAAR,CAAc,OAAd,CAFvB;QAAA,IAGIE,gBAAgB,GAAGL,OAAO,CAACM,OAAR,CAAiB,yBAAjB,CAHvB;QAAA,IAIIC,UAAU,GAASC,QAAQ,CAAEH,gBAAgB,CAACI,IAAjB,CAAuB,KAAvB,CAAF,CAJ/B;;QAMA,IAAK,aAAa,OAAOP,MAApB,IAA8BA,MAAM,CAACV,IAAP,GAAcC,MAAd,GAAuB,CAA1D,EAA8D;UAC1DE,MAAM,CAACe,EAAP,CAAUC,KAAV,CAAgBC,QAAhB,CAA0B,uBAA1B,EAAmDV,MAAnD,EAA2DK,UAA3D,EAAuEH,KAAvE,EAA8Ef,CAA9E,EAAiFW,OAAjF,EAA0FK,gBAA1F,EAA4GlB,QAA5G;UACAQ,MAAM,CAACe,EAAP,CAAUC,KAAV,CAAgBC,QAAhB,CAA0B,2BAA2BV,MAArD,EAA6DK,UAA7D,EAAyEH,KAAzE,EAAgFf,CAAhF,EAAmFW,OAAnF,EAA4FK,gBAA5F,EAA8GlB,QAA9G;QACH;MACJ,CAXD;MAaAQ,MAAM,CAACe,EAAP,CAAUC,KAAV,CAAgBE,SAAhB,CAA2B,uBAA3B,EAAoD,+BAApD,EAAqF,KAAKC,4BAA1F,EAAwH,EAAxH;IACH;EAtGJ;IAAA;IAAA,OAmHG,sCAAwCZ,MAAxC,EAAwDK,UAAxD,EAA4EH,KAA5E,EAA2Ff,CAA3F,EAAkH;MAC9G,QAASa,MAAT;QACI,KAAK,OAAL;UACIb,CAAC,CAACS,cAAF;UACAnB,UAAU,CAACoC,YAAX,GAA0BC,aAA1B,CAAyCT,UAAzC,EAAqDH,KAArD;UACA;MAJR;IAMH;EA1HJ;IAAA;IAAA,OAgIG,4BAA0B;MACtB,IAAMjB,QAAQ,GAAG,IAAjB;MACAA,QAAQ,CAACF,QAAT,CAAkBgC,IAAlB;MAEAtB,MAAM,CAACuB,WAAP,CAAmBC,YAAnB,CACI,KADJ,EACW,iCADX,EAEI;QAAEC,OAAO,EAAGzB,MAAM,CAACC,mBAAP,CAA2BwB;MAAvC,CAFJ,EAGI;QACIC,OADJ,mBACalB,IADb,EACyB;UAAEhB,QAAQ,CAACL,iBAAT,CAA2BwC,IAA3B,CAAiCnB,IAAjC;QAA0C,CADrE;QAEIoB,MAFJ,oBAEa;UAAEpC,QAAQ,CAACF,QAAT,CAAkBuC,IAAlB;QAA2B;MAF1C,CAHJ;IAQH;EA5IJ;IAAA;IAAA,OAoJG,wBAAuBC,OAAvB,EAAyC;MACrC,IAAMtC,QAAQ,GAAG,IAAjB;MACAA,QAAQ,CAACF,QAAT,CAAkBgC,IAAlB;MAEAtB,MAAM,CAACuB,WAAP,CAAmBnB,cAAnB,CACIJ,MAAM,CAACC,mBAAP,CAA2BwB,OAD/B,EAEIzB,MAAM,CAACC,mBAAP,CAA2B8B,oBAF/B,EAGI;QAAED,OAAO,EAAEA;MAAX,CAHJ,EAII;QACIJ,OADJ,qBACc;UAAElC,QAAQ,CAACH,SAAT,CAAmBO,GAAnB,CAAwB,EAAxB;UAA8BJ,QAAQ,CAACwC,gBAAT;QAA8B,CAD5E;QAEIJ,MAFJ,oBAEa;UAAEpC,QAAQ,CAACF,QAAT,CAAkBuC,IAAlB;QAA2B;MAF1C,CAJJ,EAQIrC,QARJ;IAUH;EAlKJ;IAAA;IAAA,OA2KG,uBAAsBoB,UAAtB,EAA0CH,KAA1C,EAA0D;MACtD,IAAMjB,QAAQ,GAAG,IAAjB;MACAA,QAAQ,CAACF,QAAT,CAAkBgC,IAAlB;MAEAtB,MAAM,CAACuB,WAAP,CAAmBF,aAAnB,CAAkCT,UAAlC,EAA8CH,KAA9C,EAAqD;QACjDiB,OADiD,qBACvC;UAAElC,QAAQ,CAACwC,gBAAT;QAA8B,CADO;QAEjDJ,MAFiD,oBAExC;UAAEpC,QAAQ,CAACF,QAAT,CAAkBuC,IAAlB;QAA2B;MAFW,CAArD,EAGGrC,QAHH;IAIH;EAnLJ;IAAA;IAAA,OA4DG,wBAAyC;MACrC,IAAK,CAAER,UAAU,CAACQ,QAAlB,EAA6B;QACzBR,UAAU,CAACQ,QAAX,GAAsB,IAAIR,UAAJ,EAAtB;MACH;;MAED,OAAOA,UAAU,CAACQ,QAAlB;IACH;EAlEJ;;EAAA;AAAA;;ACND;AAGAN,MAAM,CAAE,UAAW+C,CAAX,EAAe;EAEnBjC,MAAM,CAACkC,cAAP,GAAwBlD,uBAAA,EAAxB;AACH,CAHK,CAAN,C","sources":["webpack://dws-internal-comments/./src/assets/dev/ts/models/IC_MetaBox.ts","webpack://dws-internal-comments/./src/assets/dev/ts/metabox.ts"],"sourcesContent":["import * as jQuery from \"jquery\";\nimport { Window } from \"../interfaces\";\ndeclare let window: Window;\n\n /**\n * @since   1.0.0\n * @version 1.0.0\n */\n export class IC_MetaBox {\n    // region FIELDS AND CONSTANTS\n\n    /**\n     * @since   1.0.0\n     * @version 1.0.0\n     *\n     * @private\n     */\n    private static instance: IC_MetaBox;\n\n    /**\n     * @since   1.0.0\n     * @version 1.0.0\n     */\n    readonly $metabox: JQuery;\n\n    /**\n     * @since   1.0.0\n     * @version 1.0.0\n     */\n    readonly $comments_wrapper: JQuery;\n\n    /**\n     * @since   1.0.0\n     * @version 1.0.0\n     */\n    readonly $textarea: JQuery;\n\n    /**\n     * @since   1.0.0\n     * @version 1.0.0\n     */\n    readonly $overlay: JQuery;\n\n    // endregion\n\n    // region CONSTRUCTORS\n\n    /**\n     * @since   1.0.0\n     * @version 1.0.0\n     */\n    private constructor() {\n        this.$metabox          = jQuery( '#dws-internal-comments' );\n        this.$comments_wrapper = this.$metabox.find( '.dws-internal-comments' );\n        this.$textarea         = this.$metabox.find( '#new-internal-comment' );\n        this.$overlay          = this.$metabox.find( '.dws-internal-comments-overlay' );\n\n        this.init();\n    }\n\n    // endregion\n\n    // region METHODS\n\n    /**\n     * @since   1.0.0\n     * @version 1.0.0\n     */\n    public static get_instance(): IC_MetaBox {\n        if ( ! IC_MetaBox.instance ) {\n            IC_MetaBox.instance = new IC_MetaBox();\n        }\n\n        return IC_MetaBox.instance;\n    }\n\n    /**\n     * @since   1.0.0\n     * @version 1.0.0\n     *\n     * @protected\n     */\n    protected init(): void {\n        const instance = this;\n\n        this.$metabox.on( 'click', 'button.save-insert-internal-comment', function( e ) {\n            const comment = instance.$textarea.val();\n\n            if ( 'string' !== typeof comment || comment.trim().length === 0 ) {\n                alert( window.dws_ic_metabox_vars.empty_comment_msg );\n                return;\n            }\n\n            e.preventDefault();\n            instance.insert_comment( comment );\n        } );\n        this.$metabox.on( 'click', '.dws-internal-comment__actions .internal-comment-action ', function( e ) {\n            const $target          = jQuery( e.target ),\n                action           = $target.data( 'action' ),\n                nonce            = $target.data( 'nonce' ),\n                $comment_wrapper = $target.parents( 'li.dws-internal-comment' ),\n                comment_id       = parseInt( $comment_wrapper.attr( 'rel' ) );\n\n            if ( 'string' === typeof action && action.trim().length > 0 ) {\n                window.wp.hooks.doAction( 'dws_ic.metabox.action', action, comment_id, nonce, e, $target, $comment_wrapper, instance );\n                window.wp.hooks.doAction( 'dws_ic.metabox.action.' + action, comment_id, nonce, e, $target, $comment_wrapper, instance );\n            }\n        } );\n\n        window.wp.hooks.addAction( 'dws_ic.metabox.action', 'dws/internal-comments/metabox', this.comment_action_click_handler, 10 );\n    }\n\n    /**\n     * @since   1.0.0\n     * @version 1.0.0\n     *\n     * @param   action\n     * @param   comment_id\n     * @param   nonce\n     * @param   e\n     *\n     * @protected\n     */\n    protected comment_action_click_handler( action: string, comment_id: number, nonce: string, e: JQuery.ClickEvent ) {\n        switch ( action ) {\n            case 'trash':\n                e.preventDefault();\n                IC_MetaBox.get_instance().trash_comment( comment_id, nonce );\n                break;\n        }\n    }\n\n    /**\n     * @since   1.0.0\n     * @version 1.0.0\n     */\n    public refresh_comments() {\n        const instance = this;\n        instance.$overlay.show();\n\n        window.dws_ic_ajax.make_request(\n            'GET', 'dws_ic_get_comments_list_output',\n            { post_id : window.dws_ic_metabox_vars.post_id, },\n            {\n                success( data: any ) { instance.$comments_wrapper.html( data ); },\n                always() { instance.$overlay.hide(); },\n            }\n        );\n    }\n\n    /**\n     * @since   1.0.0\n     * @version 1.0.0\n     *\n     * @param   content\n     */\n    public insert_comment( content: string ) {\n        const instance = this;\n        instance.$overlay.show();\n\n        window.dws_ic_ajax.insert_comment(\n            window.dws_ic_metabox_vars.post_id,\n            window.dws_ic_metabox_vars.insert_comment_nonce,\n            { content: content },\n            {\n                success() { instance.$textarea.val( '' ); instance.refresh_comments(); },\n                always() { instance.$overlay.hide(); },\n            },\n            instance\n        );\n    }\n\n    /**\n     * @since   1.0.0\n     * @version 1.0.0\n     *\n     * @param   comment_id\n     * @param   nonce\n     */\n    public trash_comment( comment_id: number, nonce: string ) {\n        const instance = this;\n        instance.$overlay.show();\n\n        window.dws_ic_ajax.trash_comment( comment_id, nonce, {\n            success() { instance.refresh_comments(); },\n            always() { instance.$overlay.hide(); },\n        }, instance );\n    }\n\n    // endregion\n}","import jQuery from \"jquery\";\nimport { Window } from \"./interfaces\";\nimport { IC_MetaBox } from \"./models/IC_MetaBox\";\ndeclare let window: Window;\n\njQuery( function ( $ ) {\n    // Instantiate the metabox singleton class and start listening to events.\n    window.dws_ic_metabox = IC_MetaBox.get_instance();\n} );\n"],"names":["IC_MetaBox","$metabox","jQuery","$comments_wrapper","find","$textarea","$overlay","init","instance","on","e","comment","val","trim","length","alert","window","dws_ic_metabox_vars","empty_comment_msg","preventDefault","insert_comment","$target","target","action","data","nonce","$comment_wrapper","parents","comment_id","parseInt","attr","wp","hooks","doAction","addAction","comment_action_click_handler","get_instance","trash_comment","show","dws_ic_ajax","make_request","post_id","success","html","always","hide","content","insert_comment_nonce","refresh_comments","$","dws_ic_metabox"],"sourceRoot":""}